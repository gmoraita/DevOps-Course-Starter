services:
- docker

branches:
  only:
    - master
    - module_11


before_script:
- echo "Test the TODO list"
- docker build --target testing-offline --tag todo-app:devops-course-starter_todoapp-test-offline .
- docker run --env-file .env.test todo-app:devops-course-starter_todoapp-test-offline
- docker build --target testing-online --tag todo-app:devops-course-starter_todoapp-test-online .
- docker run  -e DB_USERNAME=$DB_USERNAME -e DB_PASSWORD=$DB_PASSWORD -e DB_CLUSTER=$DB_CLUSTER todo-app:devops-course-starter_todoapp-test-online
      
script: 
- echo "Build the TODO list"
- docker build --target production --tag $DOCKER_USER/todo-app:$TRAVIS_COMMIT .

- echo "Push the TODO list to Docker Hub"
- echo $DOCKER_PWD | docker login --username $DOCKER_USER --password-stdin
- docker push $DOCKER_USER/todo-app:$TRAVIS_COMMIT

- echo "Push the TODO list to Heroku"
- docker pull $DOCKER_USER/todo-app:$TRAVIS_COMMIT
- docker tag $DOCKER_USER/todo-app:$TRAVIS_COMMIT registry.heroku.com/georgestodoapp/web
- heroku container:login
- docker push registry.heroku.com/georgestodoapp/web
- heroku container:release web -a georgestodoapp


env:
  global:
    - secure: "IstOGvoARYkWeOIxXW6qc3WsKFKFauLf4qpUngSQAoCn2YrAG/CTwq8IqBxW56jdaWecckB+XpwRRTVWBerFugVsd92soI9dD69Ti8K6LK89o80aXZZiYSwY52aDnxurtwP/Q8RXSrNilsYUQGxJ860OTEaWxWkJ4gAhHEkc1MPqHS85Fk9DvOzLPzeOsXaauj9EGy9RVFrgI/nHTb9U7+Q9oAFzw06JWa5vc2N3Xkh1DvczIYbyCJBPBjmrx58uwCO9q5XZT9J15KIdyKCqAUjn2mc1mYIyXVpPPXMBJl/zxTqz9p5//yb/V95f1evGom6iGpy8sMybCPLTKE2CMBQdwxuVX4ibXgf9ghKlPUfchotGP6VCMuZccRJ3S2M4LVveR9EsthK6KGSNonDp6Iqt1ITvyMeux4ZyNFhIYO6B+DL5MOGIdr+B3NoNob/USi1GWlpKwssn/1D/RQGoH/++MINBVrRkOdcWbBSvenMGK5MPIQ2IObsF48nvsOzvWbRoDssLupIC+w/FNtJ3h5BKZUnQFfvHbXQREVBOnH0XM2EE8LOavGLEwCk8hR/96QVCiWDP8KsksAd4c//f43dHwpaYQ9jxcF20lmIHVDz7N/EwL5rRkITuwG7iAxsjFJ5+p2159Bn3FqYktoyyqVef8UjE5OVsMx+1X9cA2TE="
    - secure: "pa8WfZxXXp6Szfvvxtd84yHGv1Sp6TFpl2/eUVIVP1CDs1uoiDKStApNg53J482vp8yb2BS6YYjLOpNuC21b1CRAqvbzy8zlujdtzXi2J/4HTqy5psCSm/sw/v5mzf96xeYOv9xg5B8PO1vkXcosrf0k6+nCuDhfmun17IY84BB88NqR88kFqk19MAaLPgOdA+x/YAXGYYDXWgwNCVAajn1XNaOHTzMyCbqOXqM3iAaFIF4IYj5My5MGq8LuZhfelCBQt0g64MBiMjkYKeyLNwqwxC5yh7gPFEXZpaE5FFq4tB3YnB4DGQIkP5eKaLf/9DNmxqQuTKq69nVKpo3bphy3v/n5vBDTyOC1ax/W4kB0qQZ3tw+NqfSFUFlTm4laQEeavokgE9Lk4baVStyCtcg/7BP8ZsfGs2lwD7qmCBDHMwHU7Y2hfEdQ+Rtrvw1bjFzu+jz9fc9j3sVY158Eg3taLybJg8sadVvVQty+IQ0pwsMJ+s5xLvabI9K/dAIG81LV1UBPCLIfDXlrmIANeaM3bvbxhcHQlc4hdLkf4fREe3pdz2rp2CgVg9hmk4K0+HJ0VtawWogB99E/IhBENaRgRr2j6J4SDVs7KqwLoG4Jo6scq+61gH1/PKYmVjdVabcMgvFtFGc68OY0J5W28rP1NZhtbrU/Yipzplwt5hs="
    - secure: "ainbEdWOUPMB4JngePXDuU58EN4FGbEVEnkrgv4DQPbDb2+vYVzzbKCOMOniVtch0k3bhdO7GlvIbv6dnf/xAQuGOeuIX1g0Ameo+QGfudn50mVGug2+5PRtM/VLARt2gl1yIQAMn5EyYHKwEmfSWakqCLTQRIUPBpbntcNTYxgtgsXwqH65m4ey6bQtkg3mLk+XvyDi/H/QXIWTd9N3aaXCKPdCoQuq7NPxFoCHVO2ZflDJuSVruySaqP3uPXzcR6+nfzMxXePL2eMacZcB+fseqJev002DfiQleNP1GKW2XIzB0QUn2tl7e+StoTnT9JZ1w+bfoEVWAcYJEDle+Ga5Md395KbrRrHoBFyESIeUrYEXjr+PeXR7/wmN8ZCKeJ1hXzwqMppSQ+zcuYiRqeXy76zywQUbu9kaV3X2U2aut/RClNTWqsUmeFCsM1S9QS+1msrI8Qp+nRnfTqu1pm973ufmzAy1gIWd8e4xOygq7ACnMKcxlv52VeQgvuMN5v+gQcUvyBjDFKHAnsEokOWZ+Q8HS/6LlrjoNgJlm+mookQ97tgNJdPxeRfUhpDIDEtRN5zKOJCoIPGmAWA9nxzpL97RzdyzMsb2VIqUPOshFEjQyX7qbBFDGv0VrrE0nHymaudj+aDng1d0G3onq7JDWrYqhTa3e7ZEl2CDoiM="
    - secure: "bUPC3kaasZrLwEfz4hOD3T5NV+GnW/TSlNdtq6ybzwfCiCK9hDHtoePhHpLGmc2lChQ0DbKlDpoke1bUXFKuCHWB33oUlDRHBXYRiLDppFQoHzvD8gDzd290kUjQiBMfeie2xxyl46wTax3pf8aI+l66zxR7U4eeRm9cIKt8wRHy+5SQ0YcWnB+mwUzy6ufAWwCSsA6tHIbPlRTTE8P40spdTLegp2ssBpxHf1JYEb144yZV8ttqoEe2/5W5zF5Kp+7qX4VuWnuthpc8FodfE67Nu/d5PvWOxQK/CMSpCyXXP6vLqKg6EcLVHO/F5kpsxK9nebw1lW2BjXv59cKp1dqQ9UyY3tnRIvY+yd3Lg7JC22d1UMrjktd2msslMWGmm/HyLGqLHw9S+RORmREr/DaYJHtsQGDtn711fdcVZOcI0k90shFw4f5pqjQSa1FvMykDntjRNEgky0ihj3cY9GcStuAqZYizA+Yv+MlnqaQ4E1DlVPnd3JMFwCFHiSwKhqIkGMIXFOiF6Nr0R9M19sc6MFZwMLtobKBfGw/vc5PzGMiwMEu/70OUhbDMi1mIOHbbXcCnkfehqJNiKEmAy3Zcn+KpK34Myer3QTEQXpN492idmqbvjeMcdAhyWXAqYowWiuTgHLuvlv4Q+MqiV2ZQHKfQZpr8T7SjOqM3cNE="
    - secure: "Q+LkmbQODaPDwPViC+uClnErcXPN1NtV/XPkVaB7E3JeUl2jXAsHz5tCQDQR0RAh8ril3Y4e0tDuQdlYiDxZrvXATX3hBbTy81wd2xPelBCuCpClXUJEQJCsPGtOASfab2poC0IhekvWz31AppPGSxMR2v5h3j+xEw5XY30Q0Rl1HclngyCn3bGFA9RZzr3LScqfaD6iiwjYzCZZnXmgK9ugpU4iEqkpBRPT7N0FSXXWmj3COJRUfeQNEkkUJ01D/RxjyU+xeWtLdzdsEakMD0txGXIY7aaPnZNLpWJr5Bo4bqu+DNACT2NWpoq/d6YurNG6OOksaVbhbwS6NNNIxMlJ/WUpKDYlzxcMkUpqGVRy0gHGo40JwszJ5FJAJqFRr042XlSv1W+L+DVWnCBbPgEWuGtLBbVZ+UCuDEzdr+id403LolN/23rS0MgJKQknd6FHgNlimjxwFWNsx5ky1ZvSliwrI1PRKCafuxUUnzPRw2Eug0LcGYAHm1gIOXTvKO2bZVu70wn2Jh1YjezhsQHIMo0wm3fYDFrspmKYliqxFBxN9yaMvSBL284vmzND13gyQ50ycHpev6ZzQ54Kbfb/Tco5WfxD6JLLrguJgUNIx4woEjHqz1Lgh6qrlUwPl5EUzgZLyVLzqFvPuvji6XtJm4HAHHCROFXS9b5er5w="
    - secure: "aZznTD78yfCR5HXOwk2ci5hFOEcYkG+IRTiRhm2OQ1u6XGRXSQpukwo8GlyzW2KCEYetiee0P6H3QCpRu4xSE3S+2j2hjG1eUFaRM9AKtxbhDbUHD/yEEdVv6qG2WlbUIObdism8h8YTssG5gQ+58uWrDPve4cpnHX8q5FatcGITk6+yRDSNvwPA6FIVfDKDUgdc0/OkibxnxCsq9QE9CF/qKQKk+FI7Da9+JHhhZ4lHRE3UnALTthK3AHLhuZuJuSnnnuIAkTsNPnSYk28OPV2YFb8nV7twyKvF7XpXpE0yGDxqa43ixSlJg5TXWRdAvn9KJPK/mQ1hjEL2BF79y76L3jSeSp1I9L3C8BIaCJFUiv8HYljZvrn+XmkQuMrkQXfccWZsL8eNXDPa/o4nUkrWneKmzJ3inAiKZsQ+DxMH87be4SB8qQn8JKc+FFKmKrDFI+Nm3D+dCUIykcbOdIAzYMN4viI+YrZN15c9HlNJUlPK1jOVLZbWoLBRiwF6Hv6XlV/+DPcn7WWwt3lwlLachtG8fkxqxetm0xzps7exTnoz97XEhSYotlw3m9mPeikd7o3/f7jpfgdo4unKD0lzbhmnhFKMT0YvYQfwaIGpC6VC44GBdvyqJrVowWWa95Pzx/i2R/4mtg+bYFyomKvpKwI+CiVYkK1OiWA0VeA="
    - secure: "cmGdYtHKZMlSp/PFDzH9FnTP2XcHTvbU3cIp8Tl6HbSK7VGcChILu1547858wvNT43yNOsJNLcE97dGP5F519R+QrP57QJm7yK2E7G1gonG3Fbk7GMNlGhA3IePagDvl8n3xPR5M6fFUmetGdXJ0qSqC1DiPkHTNlhzlWKYVjoqePyXvkLcgBbEw74V69EvSiYORbDFj+i+bNIXMwlhXx9zkh4PLfosvAGRfDWMItR8vXN9qqxECWrLSfw81Po6TjtmDYoinmxsxGArlTede/087cYIJLBC8zHGWEt3ggdV6EoHEUVzZAJOiLFmYIG/RVyiWPT8A3TUVC5g6n/n65ML+NlV+DVz/gtRmnTcQFZrtwpxnqykzRgbnTWgBD6ZnHuh574fB48EAis00UXcUK6rnjGEkr9duq2XwiADl6FUBdm8/zknEV8Saw0An9hwohduLS/R7Qxffibp1w9v5WnozRj7mKQe7gJVO8MD3k98emNI8YA4FiJYU5gtDOL6nTHBpm89VvEfx2H+DJZMsUWhLs/YPqSW+Gk9xJfJ9J9pX2bkE/W+2OXxIWEhgw3AN26ElxtxqSK0ynmt0GQfpZBgBbUbBwhAeQSxiWD7FJNN1BGHIH8fW8+sdf8cpQg4epbX0UkB9OV3UCJdezvjuh1lyVKxpB4REviDNn0lnDBI="
